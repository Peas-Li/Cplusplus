# å•ä¾‹æ¨¡å¼

å½“æˆ‘ä»¬åœ¨ä½¿ç”¨ç±»æ¥newåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨æ„é€ å‡½æ•°ï¼Œæ¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡éƒ½ä¼šè°ƒç”¨æ„é€ å‡½æ•°æ¥æ„é€ ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼š

```cpp
class classA{};

void func()
{
    classA* a1 = new classA; //è°ƒç”¨æ„é€ å‡½æ•°
    classA* a2 = new classA; //è°ƒç”¨æ„é€ å‡½æ•°
    if (a1 != a2)
	{
		cout << "a1å’Œa2æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡" << endl;
	}
}

//a1å’Œa2æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡
```

**æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼š**

æ—¢ç„¶æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œé‚£ä¹ˆå°±åº”è¯¥ç¦æ­¢ç±»çš„å¤–éƒ¨è®¿é—®æ„é€ å‡½æ•°ï¼Œå› ä¸ºæ¯æ¬¡åœ¨ç±»çš„å¤–éƒ¨è°ƒç”¨æ„é€ å‡½æ•°éƒ½ä¼šæ„é€ å‡ºä¸€ä¸ªæ–°çš„å®ä¾‹å¯¹è±¡ã€‚è§£å†³åŠæ³•å°±æ˜¯æŠŠæ„é€ å‡½æ•°è®¾ç½®ä¸ºç§æœ‰å±æ€§ï¼Œåœ¨ç±»çš„å†…éƒ¨å®Œæˆå®ä¾‹åŒ–å¯¹è±¡çš„åˆ›å»ºï¼Œè¿™æ ·å°±å¯¹å¤–éšè—äº†åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ã€‚ä½†æ˜¯ç±»çš„å‡ºç°å°±æ˜¯è¦å®šä¹‰å¯¹è±¡çš„ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ç±»åˆ›å»ºçš„å¯¹è±¡ï¼Œæ‰€ä»¥è¿˜éœ€è¦æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è·å–ç±»å†…éƒ¨åˆ›å»ºå¥½çš„å¯¹è±¡ï¼š

1. æ„é€ å‡½æ•°ç§æœ‰åŒ–ï¼›
2. æä¾›å…¨å±€è®¿é—®ç‚¹ï¼›
3. å†…éƒ¨å®šä¹‰ä¸€ä¸ªstaticé™æ€æŒ‡é’ˆæŒ‡å‘å½“å‰ç±»å®šä¹‰çš„å¯¹è±¡ï¼›

```cpp
class SingletonPattern
{
private:
	SingletonPattern()
	{
		cout << "ç§æœ‰çš„æ„é€ å‡½æ•°" << endl;
	}
public: //æ„é€ å‡½æ•°è¢«ç§æœ‰åŒ–äº†ï¼Œæ‰€ä»¥åº”è¯¥æä¾›ä¸€ä¸ªå¯¹å¤–è®¿é—®çš„æ–¹æ³•ï¼Œæ¥åˆ›å»ºå¯¹è±¡
	static SingletonPattern* get_single() 
	{
		if (single == NULL) //ä¸ºä¿è¯å•ä¾‹ï¼Œåªnewä¸€æ¬¡
		{					//å¦‚æœä¸åŠ è¿™ä¸ªåˆ¤æ–­ï¼Œæ¯æ¬¡åˆ›å»ºå¯¹è±¡éƒ½ä¼šnewä¸€ä¸ªsingleï¼Œè¿™å°±ä¸æ˜¯å•ä¾‹äº†
			single = new SingletonPattern;
		}
		//return this->single;
		return single; //é™æ€æˆå‘˜å±äºæ•´ä¸ªç±»ï¼Œæ²¡æœ‰thisæŒ‡é’ˆ
	}
private: //static æˆå‘˜ï¼Œç±»å®šä¹‰çš„æ‰€æœ‰å¯¹è±¡å…±æœ‰staticæˆå‘˜
	static SingletonPattern* single; //æŒ‡é’ˆï¼Œä¸èƒ½æ˜¯å˜é‡ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¸çŸ¥é“å¦‚ä½•åˆ†é…å†…å­˜
};

SingletonPattern* SingletonPattern::single = NULL; //å‘Šè¯‰ç¼–è¯‘å™¨åˆ†é…å†…å­˜

int main()
{
    SingletonPattern* s1 = SingletonPattern::get_single(); //åœ¨get_singleä¸­ä¼šnewä¸€ä¸ªå¯¹è±¡
	SingletonPattern* s2 = SingletonPattern::get_single(); 
	if (s1 == s2)
	{
		cout << "å•ä¾‹" << endl;
	}
	else
	{
		cout << "ä¸æ˜¯å•ä¾‹" << endl;
	}
}

//ç§æœ‰çš„æ„é€ å‡½æ•°
//å•ä¾‹
```

ä¸Šé¢ç¨‹åºæ‰€ç¤ºçš„å°±æ˜¯ä¸€ä¸ªæ‡’æ±‰å¼å•ä¾‹æ¨¡å¼çš„å®ç°ã€‚è¿™é‡Œé¢æœ‰å‡ ç‚¹è¦æ³¨æ„çš„ï¼š

ï¼ˆ1ï¼‰ä¸ºäº†è®©è¿™ä¸ªç±»æ‰€å®šä¹‰çš„æ‰€æœ‰å¯¹è±¡å…±äº«å±æ€§ï¼Œåº”è¯¥æŠŠå±æ€§è®¾ç½®ä¸ºstaticç±»å‹ï¼Œå› ä¸ºstaticç±»å‹çš„å±æ€§å±äºæ•´ä¸ªç±»è€Œä¸æ˜¯å±äºæŸä¸ªå¯¹è±¡ã€‚

ï¼ˆ2ï¼‰ä¸ºäº†ä¿è¯å•ä¾‹æ¨¡å¼ï¼Œåº”è¯¥åœ¨å…¨å±€è®¿é—®ç‚¹get_single()å‡½æ•°ä¸­åŠ ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœå¯¹è±¡å·²ç»è¢«åˆ›å»ºäº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡è¿˜æ²¡æœ‰è¢«åˆ›å»ºï¼Œé‚£ä¹ˆä¹…newåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ã€‚

ï¼ˆ3ï¼‰å› ä¸ºæ˜¯åœ¨ä½¿ç”¨åˆ°å¯¹è±¡çš„æ—¶å€™ï¼Œæ‰å»åˆ›å»ºå¯¹è±¡ï¼ˆsingleåˆå§‹åŒ–ä¸ºNULLï¼Œåœ¨å…¨å±€è®¿é—®ç‚¹get_singleè¢«è°ƒç”¨çš„æ—¶å€™æ‰å»åˆ›å»ºå¯¹è±¡ï¼‰ï¼Œæœ‰ç‚¹å·æ‡’çš„æ„Ÿè§‰ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºæ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ã€‚

**æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼çš„ç¼ºé™·**

é€šè¿‡æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç±»åªåˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œä¸”åªæœ‰åœ¨ç”¨åˆ°å®ä¾‹å¯¹è±¡çš„æ—¶å€™ï¼Œæ‰ä¼šé€šè¿‡å…¨å±€è®¿é—®ç‚¹å»newåˆ›å»ºè¿™ä¸ªå¯¹è±¡ï¼ŒèŠ‚çœäº†èµ„æºã€‚ä½†æ˜¯ï¼Œæ‡’æ±‰å¼å•ä¾‹æ¨¡å¼æœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºç‚¹ï¼Œå°±æ˜¯åœ¨C++çš„æ„é€ å‡½æ•°ä¸­ï¼Œä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹éƒ½å»åˆ›å»ºå¯¹è±¡ï¼Œè°ƒç”¨å…¨å±€è®¿é—®ç‚¹get_single()çš„æ—¶å€™ï¼Œä¼šé¢ä¸´èµ„æºç«äº‰é—®é¢˜ï¼Œå‡å¦‚åœ¨ç±»çš„æ„é€ å‡½æ•°ä¸­å¢åŠ ä¸€ä¸ªå»¶è¿Ÿå‡½æ•°ï¼Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨get_single()çš„æ—¶å€™ï¼Œä¼šè¿›å…¥æ„é€ å‡½æ•°ï¼Œè¿™æ—¶ï¼Œå› ä¸ºå»¶æ—¶çš„å­˜åœ¨ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šåœ¨è¿™é‡Œå¡é¡¿ä¸€ä¼šï¼Œå‡å¦‚æ­£å¥½è¿™æ—¶å€™ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿè°ƒç”¨get_single()å»åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œè€Œç¬¬ä¸€ä¸ªçº¿ç¨‹è¿˜åœ¨æ„é€ å‡½æ•°ä¸­å»¶æ—¶ï¼Œè¿™æ ·åœ¨get_single()å‡½æ•°ä¸­(single == NULL)è¿™ä¸ªåˆ¤æ–­æ¡ä»¶ä¾ç„¶æˆç«‹ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿä¼šè¿›å…¥æ„é€ å‡½æ•°ã€‚è¿™æ ·ï¼Œä¸¤ä¸ªçº¿ç¨‹åˆ›å»ºçš„å¯¹è±¡å°±ä¸å†æ˜¯åŒä¸€ä¸ªå¯¹è±¡äº†ï¼Œä¹Ÿå°±ä¸æ˜¯å•ä¾‹æ¨¡å¼äº†ã€‚

**æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ä¸å¤šçº¿ç¨‹ï¼ˆDCLä¸é¥¿æ±‰å¼ï¼‰**ï¼š

é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠç±»æ”¹é€ ä¸€ä¸‹ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­åŠ ä¸€ä¸ªå»¶æ—¶ï¼Œå¹¶åœ¨ç±»ä¸­åŠ ä¸€ä¸ªè®¡æ•°å™¨æ¥è®°å½•æ„é€ å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°

```cpp
class SingletonPattern
{
private:
	SingletonPattern()
	{
		count++;
		Sleep(1000); //ç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨newçš„æ—¶å€™ï¼Œå¦‚æœå»¶æ—¶è¿˜æ²¡ç»“æŸ
					 //ç¬¬äºŒä¸ªçº¿ç¨‹åˆè¿‡æ¥newä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶å€™å› ä¸ºç¬¬ä¸€ä¸ªå¯¹è±¡è¿˜æ²¡æœ‰newå‡ºæ¥
					 //æ‰€ä»¥singleè¿˜æ˜¯NULLï¼Œè¿™æ ·åˆä¼šè¿›å…¥æ„é€ å‡½æ•°ï¼Œæœ€åæ€»å…±newäº†ä¸¤ä¸ªå¯¹è±¡
					 //è¿™æ ·è¿”å›çš„ä¸¤ä¸ªå¯¹è±¡æ˜¯ä¸¤æ¬¡newå‡ºæ¥çš„ï¼Œå°±ä¸æ˜¯å•ä¾‹æ¨¡å¼äº†
		printf("ç§æœ‰çš„æ„é€ å‡½æ•°\n");
	}
public:
	static int get_count()
	{
		return count;
	}
public: //æ„é€ å‡½æ•°è¢«ç§æœ‰åŒ–äº†ï¼Œæ‰€ä»¥åº”è¯¥æä¾›ä¸€ä¸ªå¯¹å¤–è®¿é—®çš„æ–¹æ³•ï¼Œæ¥åˆ›å»ºå¯¹è±¡
	static SingletonPattern* get_single() //åªæœ‰åœ¨è°ƒç”¨è¯¥å‡½æ•°çš„æ—¶å€™æ‰ä¼šnewä¸€ä¸ªå¯¹è±¡
	{
		if (single == NULL) 
		{					
			single = new SingletonPattern;
		}
		return single; 
	}
private: //static æˆå‘˜ï¼Œç±»å®šä¹‰çš„æ‰€æœ‰å¯¹è±¡å…±æœ‰staticæˆå‘˜
	static SingletonPattern* single; 
	static int count;
};

SingletonPattern* SingletonPattern::single = NULL; 
int SingletonPattern::count = 0;
```

è¿™æ ·ï¼Œä¸€ä¸ªç±»å°±å®šä¹‰å¥½äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åœ¨mainè¿›ç¨‹ä¸­åˆ›å»ºä¸‰ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨Windowsä¸‹å¤šçº¿ç¨‹ç¼–ç¨‹åº”åŒ…å«å¤´æ–‡ä»¶<process.h>ï¼Œå¹¶ä¸”ä¼šç”¨åˆ°çº¿ç¨‹åˆ›å»ºå‡½æ•°_beginthread()ï¼Œå¯¹äº_beginthread()å‡½æ•°çš„ä½¿ç”¨å¯ä»¥ç›´æ¥è½¬åˆ°æºç æŸ¥çœ‹å‡½æ•°åŸå‹

```cpp
typedef void     (__cdecl*   _beginthread_proc_type  )(void*);
typedef unsigned (__stdcall* _beginthreadex_proc_type)(void*);

_ACRTIMP uintptr_t __cdecl _beginthread(
	_In_     _beginthread_proc_type _StartAddress,
	_In_     unsigned               _StackSize,
	_In_opt_ void*                  _ArgList
);
```

è¯¥å‡½æ•°åŒ…å«ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä»£è¡¨å¦‚ä¸‹å«ä¹‰ï¼š

ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯_beginthread_proc_typeï¼Œé€šè¿‡ä¸Šé¢çš„typedefå¯çŸ¥ï¼Œå®ƒæ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼ŒæŒ‡å‘æ–°å¼€è¾Ÿçš„çº¿ç¨‹çš„èµ·å§‹åœ°å€ï¼›

ç¬¬äºŒä¸ªå‚æ•°_StackSizeæ˜¯æ–°çº¿ç¨‹çš„å †æ ˆå¤§å°ï¼Œå¯ä»¥ç›´æ¥ç»™ä¸ª0ï¼Œè¡¨ç¤ºå’Œä¸»çº¿ç¨‹å…±ç”¨å †æ ˆï¼›

ç¬¬ä¸‰ä¸ªå‚æ•°_ArgListæ˜¯ä¸€ä¸ªå‚æ•°åˆ—è¡¨ï¼Œå®ƒè¡¨ç¤ºè¦ä¼ é€’ç»™æ–°å¼€è¾Ÿçº¿ç¨‹çš„å‚æ•°ï¼Œæ–°çº¿ç¨‹æ²¡æœ‰å‚æ•°çš„è¯å¯ä»¥ä¼ å…¥NULLï¼›

å‡½æ•°è¿”å›å€¼å¯ä»¥ç†è§£ä¸ºåˆ›å»ºå¥½çš„çº¿ç¨‹çš„å¥æŸ„ã€‚

é¦–å…ˆæ­å»ºæµ‹è¯•ç¨‹åºå¦‚ä¸‹ï¼š

```cpp
{
    int i = 0, ThreadNum = 3;
	HANDLE h_thread[3];

	for (i = 0; i < ThreadNum; i++)
	{
		h_thread[i] = (HANDLE)_beginthread(_cbThreadFunc, 0, NULL);
	}

	for (i = 0; i < ThreadNum; i++)
	{
		WaitForSingleObject(h_thread[i], INFINITE); //windows ä¸‹çš„ç­‰å¾…
		//thread_join  //Linux ä¸‹çš„ç­‰å¾…å‡½æ•°
		//ç­‰å¾…å­çº¿ç¨‹ç»“æŸï¼Œå¦‚æœä¸ç­‰å¾…å­çº¿ç¨‹ç»“æŸä¸»è¿›ç¨‹å°±æ­»æ‰çš„è¯ï¼Œå­çº¿ç¨‹ä¹Ÿä¼šéšä¹‹æ­»æ‰ï¼Œæ‰€ä»¥ä¸»è¿›ç¨‹æŒ‚èµ·ç­‰å¾…
	}

	cout << "å­çº¿ç¨‹å·²ç»“æŸ" << endl;
}
```

**é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼**

ç¬¬ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯åœ¨ç±»ä¸­å®šä¹‰static SingletonPattern*æŒ‡é’ˆçš„æ—¶å€™å°±åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å…¨å±€è®¿é—®ç‚¹get_single()ç›´æ¥è¿”å›åˆ›å»ºå¥½çš„å¯¹è±¡ï¼Œå› ä¸ºå¯¹è±¡æ—©å°±æå‰åˆ›å»ºå¥½äº†ï¼Œè¿™æ ·å³ä½¿å¤šä¸ªçº¿ç¨‹è°ƒç”¨åˆ›å»ºå¯¹è±¡æ‰€å¾—åˆ°çš„ä¹Ÿæ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚å› ä¸ºå¯¹è±¡è¿˜æ²¡ä½¿ç”¨å°±åˆ›å»ºå¥½äº†ï¼Œæ‰€ä»¥å«åšé¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ã€‚

ä¸Šé¢çš„æµ‹è¯•ç¨‹åºä¸ç”¨ä¿®æ”¹ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ç±»å³å¯ï¼š

```cpp
class SingletonPattern
{
private:
	SingletonPattern()
	{
		count++;
		Sleep(1000); 
		printf("ç§æœ‰çš„æ„é€ å‡½æ•°\n");
	}
public:
	static int get_count()
	{
		return count;
	}
public: 
	static SingletonPattern* get_single()
	{
		return single;
	}
private: 
	static SingletonPattern* single; 
	static int count;
};

//SingletonPattern* SingletonPattern::single = NULL;
SingletonPattern* SingletonPattern::single = new SingletonPattern; //é¥¿æ±‰å¼å•ä¾‹ï¼Œä¸€å¼€å§‹å°±newäº†ä¸€ä¸ªå¯¹è±¡
int SingletonPattern::count = 0;
```

å†æ¬¡è¿è¡Œå‰é¢çš„æµ‹è¯•å‡½æ•°ï¼Œæ„é€ å‡½æ•°è°ƒç”¨æ¬¡æ•°ä¸€ç›´ä¸º1ï¼›

**DCL(double-checked locking)**

å¯¹ä¸´ç•ŒåŒºèµ„æºåŠ ä¸€ä¸ªé”ğŸ”’ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹æŒ‚èµ·ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œåªæœ‰æŒæœ‰é”çš„çº¿ç¨‹æ‰èƒ½è¿›å…¥ä¸´ç•Œèµ„æºï¼Œè¿™å°±è§£å†³äº†å¤šçº¿ç¨‹èµ„æºç«äº‰çš„é—®é¢˜ï¼ˆæ­¤å¤„æ¶‰åŠåˆ°å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼‰ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ¤æ–­(single == NULL)åï¼Œå¦‚æœä¹‹å‰æ²¡æœ‰åˆ›å»ºå¯¹è±¡ï¼Œé‚£ä¹ˆå°±è¿›å…¥ä¸‹é¢çš„ä¸´ç•ŒåŒº

```cpp
if (single == NULL)  
{   
	cs.Lock(); 
	single = new SingletonPattern;
	cs.Unlock();
}
```

å½“ç¬¬ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå®Œå¯¹è±¡åé‡Šæ”¾äº†é”ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºåˆåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¹Ÿè¿åäº†å•ä¾‹åŸåˆ™ã€‚æ‰€ä»¥åº”è¯¥åŠ å…¥ä¸€ä¸ªäºŒæ¬¡æ£€æŸ¥ï¼Œå¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹å·²ç»åˆ›å»ºäº†å¯¹è±¡ï¼ˆæŒ‡é’ˆä¸ä¸ºNULLï¼‰ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªçº¿ç¨‹å³ä½¿è·å–äº†é”ï¼Œä¹Ÿä¸å†åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ç¬¬ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºçš„å¯¹è±¡ï¼Œè¿™å°±æ˜¯äºŒæ¬¡æ£€æµ‹çš„åŸå› ã€‚

```cpp
static SingletonPattern* get_single() 
{
	if (single == NULL)  //double check 
	{   //å› ä¸ºåœ¨è¿™ä¹‹å‰å¹¶æ²¡æœ‰ä¿æŠ¤æœºåˆ¶ï¼Œæ‰€ä»¥ä¸‰ä¸ªçº¿ç¨‹éƒ½æœ‰å¯èƒ½æ‰§è¡Œåˆ°è¿™ä¸€æ­¥
		cs.Lock(); 
		if (single == NULL) //æ‰€ä»¥éœ€è¦äºŒæ¬¡æ£€æŸ¥ï¼Œè¿›å…¥ä¸´ç•ŒåŒºåå†ä¸€æ¬¡åˆ¤æ–­
		{
			single = new SingletonPattern;
		}
		cs.Unlock();
	}
	return single; //é™æ€æˆå‘˜å±äºæ•´ä¸ªç±»ï¼Œæ²¡æœ‰thisæŒ‡é’ˆ
}
```

å¯¹å…¨å±€è®¿é—®ç‚¹get_single()ä¿®æ”¹è¿‡åï¼Œå†æ¬¡è¿è¡Œæµ‹è¯•å‡½æ•°ï¼Œæ„é€ å‡½æ•°è°ƒç”¨æ¬¡æ•°ä¸€ç›´ä¸º1ï¼›































